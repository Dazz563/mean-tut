"use strict";(self.webpackChunkmean_tut=self.webpackChunkmean_tut||[]).push([[50],{6050:(D,P,r)=>{r.r(P),r.d(P,{PostsModule:()=>q});var g=r(6895),m=r(7315),v=r(3870),p=r(433),b=r(9646),L=r(9751);const T=s=>{if("string"==typeof s.value)return(0,b.of)(null);const i=s.value,e=new FileReader;return new L.y(o=>{e.addEventListener("loadend",()=>{const a=new Uint8Array(e.result).subarray(0,4);let c="",u=!1;for(let h=0;h<a.length;h++)c+=a[h].toString(16);switch(c){case"89504e47":case"ffd8ffe0":case"ffd8ffe1":case"ffd8ffe2":case"ffd8ffe3":case"ffd8ffe8":u=!0;break;default:u=!1}o.next(u?null:{invalidMimeType:!0}),o.complete()}),e.readAsArrayBuffer(i)})};var t=r(1571),Z=r(7579),y=r(4004),O=r(2340),A=r(529);const l=`${O.N.apiUrl}/posts/`;let _=(()=>{class s{constructor(e,n){this.http=e,this.router=n,this.posts=[],this.postsUpdated=new Z.x}getPosts(e,n){this.http.get(l+`?pagesize=${e}&page=${n}`).pipe((0,y.U)(a=>({posts:a.posts.map(c=>({title:c.title,content:c.content,id:c._id,imagePath:c.imagePath,creator:c.creator})),maxPosts:a.maxPosts}))).subscribe(a=>{this.posts=a.posts,this.postsUpdated.next({posts:[...this.posts],postCount:a.maxPosts})})}getPostUpdateListener(){return this.postsUpdated.asObservable()}getPost(e){return this.http.get(l+e)}addPost(e,n,o){const a=new FormData;a.append("title",e),a.append("content",n),a.append("image",o,e),this.http.post(l,a).subscribe(c=>{this.router.navigateByUrl("/")})}updatePost(e,n,o,a){let c;"object"==typeof a?(c=new FormData,c.append("id",e),c.append("title",n),c.append("content",o),c.append("image",a,n)):c={id:e,title:n,content:o,imagePath:a,creator:null},this.http.put(l+e,c).subscribe(u=>{this.router.navigate(["/"])})}deletePost(e){return this.http.delete(l+e)}}return s.\u0275fac=function(e){return new(e||s)(t.LFG(A.eN),t.LFG(m.F0))},s.\u0275prov=t.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var x=r(7556),C=r(9549),w=r(4144),M=r(3546),f=r(4859),S=r(1572);function N(s,i){1&s&&t._UZ(0,"mat-spinner")}function U(s,i){1&s&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter a post title"),t.qZA())}function J(s,i){if(1&s&&(t.TgZ(0,"div",10),t._UZ(1,"img",11),t.qZA()),2&s){const e=t.oxw(2);t.xp6(1),t.Q6J("src",e.imagePreview,t.LSH)("alt",e.form.value.title)}}function F(s,i){1&s&&(t.TgZ(0,"mat-error"),t._uU(1,"Please enter a post content"),t.qZA())}function Y(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"form",2),t.NdJ("submit",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.onSavePost())}),t.TgZ(1,"mat-form-field"),t._UZ(2,"input",3),t.YNc(3,U,2,0,"mat-error",0),t.qZA(),t.TgZ(4,"div")(5,"button",4),t.NdJ("click",function(){t.CHM(e);const o=t.MAs(8);return t.KtG(o.click())}),t._uU(6,"Pick Image"),t.qZA(),t.TgZ(7,"input",5,6),t.NdJ("change",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.onImagePicked(o))}),t.qZA()(),t.YNc(9,J,2,2,"div",7),t.TgZ(10,"mat-form-field"),t._UZ(11,"textarea",8),t.YNc(12,F,2,0,"mat-error",0),t.qZA(),t.TgZ(13,"button",9),t._uU(14,"Save Post"),t.qZA()()}if(2&s){const e=t.oxw();t.Q6J("formGroup",e.form),t.xp6(3),t.Q6J("ngIf",e.form.get("title").invalid),t.xp6(6),t.Q6J("ngIf",""!==e.imagePreview&&e.imagePreview&&e.form.get("image").valid),t.xp6(3),t.Q6J("ngIf",e.form.get("content").invalid),t.xp6(1),t.Q6J("disabled",e.form.invalid)}}let I=(()=>{class s{constructor(e,n,o){this.postService=e,this.router=n,this.authService=o,this.enteredTitle="",this.enteredContent="",this.mode="create",this.isLoading=!1}ngOnInit(){this.authStatusSub=this.authService.getAuthStatusListener().subscribe(e=>{this.isLoading=!1}),this.form=new p.cw({title:new p.NI(null,{validators:[p.kI.required,p.kI.minLength(3)]}),content:new p.NI(null,{validators:[p.kI.required]}),image:new p.NI(null,{validators:[p.kI.required],asyncValidators:[T]})}),this.router.paramMap.subscribe(e=>{e.has("postId")?(this.mode="edit",this.postId=e.get("postId"),this.isLoading=!0,this.postService.getPost(this.postId).subscribe(n=>{this.isLoading=!1,this.post={id:n._id,title:n.title,content:n.content,imagePath:n.imagePath,creator:n.creator},this.form.setValue({title:this.post.title,content:this.post.content,image:this.post.imagePath})})):(this.mode="create",this.postId=null)})}onImagePicked(e){const n=e.target.files[0];this.form.patchValue({image:n}),this.form.get("image").updateValueAndValidity();const o=new FileReader;o.onload=()=>{this.imagePreview=o.result},o.readAsDataURL(n)}onSavePost(){this.isLoading=!0,"create"===this.mode?this.postService.addPost(this.form.value.title,this.form.value.content,this.form.value.image):this.postService.updatePost(this.postId,this.form.value.title,this.form.value.content,this.form.value.image),this.form.reset()}ngOnDestroy(){this.authStatusSub.unsubscribe()}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(_),t.Y36(m.gz),t.Y36(x.e))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-post-create"]],decls:3,vars:2,consts:[[4,"ngIf"],[3,"formGroup","submit",4,"ngIf"],[3,"formGroup","submit"],["matInput","","formControlName","title","placeholder","Title","type","text"],["mat-stroked-button","","type","button",3,"click"],["type","file",3,"change"],["filePicker",""],["class","image-preview",4,"ngIf"],["matInput","","formControlName","content","placeholder","Content","rows","4"],["mat-raised-button","","color","accent","type","submit",3,"disabled"],[1,"image-preview"],[3,"src","alt"]],template:function(e,n){1&e&&(t.TgZ(0,"mat-card"),t.YNc(1,N,1,0,"mat-spinner",0),t.YNc(2,Y,15,5,"form",1),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",n.isLoading),t.xp6(1),t.Q6J("ngIf",!n.isLoading))},dependencies:[g.O5,p._Y,p.Fj,p.JJ,p.JL,p.sg,p.u,C.TO,C.KE,w.Nt,M.a8,f.lW,S.Ou],styles:["mat-form-field[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:100%}mat-spinner[_ngcontent-%COMP%]{margin:auto}input[type=file][_ngcontent-%COMP%]{visibility:hidden}.image-preview[_ngcontent-%COMP%]{height:5rem;margin:1rem 0}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}"]}),s})();var d=r(7084),z=r(1581);function Q(s,i){1&s&&t._UZ(0,"mat-spinner")}const E=function(s){return["/edit",s]};function G(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-action-row")(1,"a",8),t._uU(2,"EDIT"),t.qZA(),t.TgZ(3,"button",9),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit,a=t.oxw(2);return t.KtG(a.onDelete(o.id))}),t._uU(4,"DELETE"),t.qZA()()}if(2&s){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("routerLink",t.VKq(1,E,e.id))}}function K(s,i){if(1&s&&(t.TgZ(0,"mat-expansion-panel")(1,"mat-expansion-panel-header"),t._uU(2),t.qZA(),t.TgZ(3,"div",6),t._UZ(4,"img",7),t.qZA(),t.TgZ(5,"p"),t._uU(6),t.qZA(),t.YNc(7,G,5,3,"mat-action-row",0),t.qZA()),2&s){const e=i.$implicit,n=t.oxw(2);t.xp6(2),t.Oqu(e.title),t.xp6(2),t.Q6J("src",e.imagePath,t.LSH)("alt",e.title),t.xp6(2),t.Oqu(e.content),t.xp6(1),t.Q6J("ngIf",n.userIsAuthenticated&&n.userId===e.creator)}}function R(s,i){if(1&s&&(t.TgZ(0,"mat-accordion",4),t.YNc(1,K,8,5,"mat-expansion-panel",5),t.qZA()),2&s){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.posts)}}function V(s,i){if(1&s){const e=t.EpF();t.TgZ(0,"mat-paginator",10),t.NdJ("page",function(o){t.CHM(e);const a=t.oxw();return t.KtG(a.onChangedPage(o))}),t.qZA()}if(2&s){const e=t.oxw();t.Q6J("length",e.totalPosts)("pageSize",e.postsPerPage)("pageSizeOptions",e.pageSizeOptions)}}function B(s,i){1&s&&(t.TgZ(0,"p",12),t._uU(1,"No posts added yet!"),t.qZA())}function H(s,i){if(1&s&&t.YNc(0,B,2,0,"p",11),2&s){const e=t.oxw();t.Q6J("ngIf",!e.isLoading)}}const k=[{path:"",component:(()=>{class s{constructor(e,n){this.postService=e,this.authService=n,this.userIsAuthenticated=!1,this.posts=[],this.isLoading=!1,this.totalPosts=0,this.postsPerPage=3,this.currentPage=1,this.pageSizeOptions=[3,5,10,25,100]}ngOnInit(){this.isLoading=!0,this.postService.getPosts(this.postsPerPage,this.currentPage),this.userId=this.authService.getUserId(),this.postsSub=this.postService.getPostUpdateListener().subscribe(e=>{this.posts=e.posts,this.totalPosts=e.postCount,this.isLoading=!1}),this.authStatusSub=this.authService.getAuthStatusListener().subscribe(e=>{this.userIsAuthenticated=e,this.userId=this.authService.getUserId()})}onChangedPage(e){this.isLoading=!0,this.currentPage=e.pageIndex+1,this.postsPerPage=e.pageSize,this.postService.getPosts(this.postsPerPage,this.currentPage)}ngOnDestroy(){this.postsSub.unsubscribe(),this.authStatusSub.unsubscribe()}onDelete(e){this.isLoading=!0,this.postService.deletePost(e).subscribe({next:()=>{this.postService.getPosts(this.postsPerPage,this.currentPage)},error:()=>{this.isLoading=!1}})}}return s.\u0275fac=function(e){return new(e||s)(t.Y36(_),t.Y36(x.e))},s.\u0275cmp=t.Xpm({type:s,selectors:[["app-post-list"]],decls:5,vars:4,consts:[[4,"ngIf"],["multi","true",4,"ngIf","ngIfElse"],["aria-label","Select page",3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],["noPosts",""],["multi","true"],[4,"ngFor","ngForOf"],[1,"post-image"],[3,"src","alt"],["mat-button","","color","primary",3,"routerLink"],["mat-button","","color","warn",3,"click"],["aria-label","Select page",3,"length","pageSize","pageSizeOptions","page"],["class","mat-body-1 info-text",4,"ngIf"],[1,"mat-body-1","info-text"]],template:function(e,n){if(1&e&&(t.YNc(0,Q,1,0,"mat-spinner",0),t.YNc(1,R,2,1,"mat-accordion",1),t.YNc(2,V,1,3,"mat-paginator",2),t.YNc(3,H,1,1,"ng-template",null,3,t.W1O)),2&e){const o=t.MAs(4);t.Q6J("ngIf",n.isLoading),t.xp6(1),t.Q6J("ngIf",n.posts.length>0&&!n.isLoading)("ngIfElse",o),t.xp6(1),t.Q6J("ngIf",n.posts.length>0)}},dependencies:[g.sg,g.O5,m.yS,f.lW,f.zs,d.pp,d.ib,d.VG,d.yz,S.Ou,z.NW],styles:["[_nghost-%COMP%]{display:block;margin-top:1rem}.info-text[_ngcontent-%COMP%]{text-align:center}mat-spinner[_ngcontent-%COMP%]{margin:auto}.post-image[_ngcontent-%COMP%]{width:100%}.post-image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;box-shadow:1px 1px 5px #00000080}mat-paginator[_ngcontent-%COMP%]{margin-top:1rem}"]}),s})()},{path:"create",component:I,canActivate:[v.a]},{path:"edit/:postId",component:I,canActivate:[v.a]}];let $=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[m.Bz.forChild(k),m.Bz]}),s})();var j=r(4466);let q=(()=>{class s{}return s.\u0275fac=function(e){return new(e||s)},s.\u0275mod=t.oAB({type:s}),s.\u0275inj=t.cJS({imports:[g.ez,$,j.m]}),s})()}}]);